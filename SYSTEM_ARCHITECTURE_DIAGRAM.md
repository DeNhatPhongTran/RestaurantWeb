## ğŸ—ï¸ System Architecture: Giao MÃ³n & Gá»i MÃ³n

### Complete Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE (React)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  StaffDelivery.jsx   â”‚    â”‚  KitchenOrder.jsx    â”‚          â”‚
â”‚  â”‚  (Waiter - ğŸ½ï¸)       â”‚    â”‚  (Chef - ğŸ‘¨â€ğŸ³)       â”‚          â”‚
â”‚  â”‚                      â”‚    â”‚                      â”‚          â”‚
â”‚  â”‚ Route: /delivery     â”‚    â”‚ Route: /kitchen      â”‚          â”‚
â”‚  â”‚ Roles: [waiter]      â”‚    â”‚ Roles: [chef]        â”‚          â”‚
â”‚  â”‚                      â”‚    â”‚                      â”‚          â”‚
â”‚  â”‚ Sections:            â”‚    â”‚ Sections:            â”‚          â”‚
â”‚  â”‚ 1. Unserved (ğŸŸ¡)    â”‚    â”‚ 1. Waiting âš ï¸ ğŸŸ¡     â”‚          â”‚
â”‚  â”‚ 2. Served (âœ…)      â”‚    â”‚ 2. Cooking (ğŸ³)      â”‚          â”‚
â”‚  â”‚ 3. Cooking (ğŸ³)     â”‚    â”‚ 3. Done (âœ…)         â”‚          â”‚
â”‚  â”‚ 4. Waiting (â³)     â”‚    â”‚                      â”‚          â”‚
â”‚  â”‚                      â”‚    â”‚ Max 20 done items    â”‚          â”‚
â”‚  â”‚ Max 20 served items  â”‚    â”‚ Auto-refresh: 5s     â”‚          â”‚
â”‚  â”‚ Auto-refresh: 5s     â”‚    â”‚ Status colors OK     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚             â”‚                           â”‚                      â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                             â”‚                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚              â”‚  OrderItemCard Component    â”‚                   â”‚
â”‚              â”‚  (Shared Grid Item)         â”‚                   â”‚
â”‚              â”‚                            â”‚                   â”‚
â”‚              â”‚ - Image + Qty badge        â”‚                   â”‚
â”‚              â”‚ - Item name                â”‚                   â”‚
â”‚              â”‚ - Table name               â”‚                   â”‚
â”‚              â”‚ - Time (HH:MM:SS)          â”‚                   â”‚
â”‚              â”‚ - Status dropdown          â”‚                   â”‚
â”‚              â”‚ - Notes (optional)         â”‚                   â”‚
â”‚              â”‚                            â”‚                   â”‚
â”‚              â”‚ Colors:                    â”‚                   â”‚
â”‚              â”‚ ğŸŸ¡ Yellow = waiting/unservedâ”‚                   â”‚
â”‚              â”‚ ğŸŠ Orange = cooking        â”‚                   â”‚
â”‚              â”‚ ğŸŸ¢ Green = cooked/served   â”‚                   â”‚
â”‚              â”‚ ğŸ”µ Blue = served           â”‚                   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
           (ApiContext - apiCall function)
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   BACKEND API (Express.js)         â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚                                    â”‚
          â”‚  GET /api/orderitems/waiter/      â”‚
          â”‚      delivery                     â”‚
          â”‚  â”œâ”€ Query: status, serving_status â”‚
          â”‚  â”œâ”€ Populate: item, reservation   â”‚
          â”‚  â”œâ”€ Enrich: table_name            â”‚
          â”‚  â”œâ”€ Sort: ordered_at ASC          â”‚
          â”‚  â”œâ”€ Limit served: 20              â”‚
          â”‚  â””â”€ Response: grouped data        â”‚
          â”‚                                    â”‚
          â”‚  GET /api/orderitems/chef/       â”‚
          â”‚      orders                       â”‚
          â”‚  â”œâ”€ Query: status                 â”‚
          â”‚  â”œâ”€ Populate: item, reservation   â”‚
          â”‚  â”œâ”€ Enrich: table_name            â”‚
          â”‚  â”œâ”€ Sort: ordered_at ASC          â”‚
          â”‚  â”œâ”€ Limit done: 20                â”‚
          â”‚  â””â”€ Response: grouped data        â”‚
          â”‚                                    â”‚
          â”‚  PUT /api/orderitems/:id          â”‚
          â”‚  â”œâ”€ Body: { status, serving_status}
          â”‚  â”œâ”€ Verify: orderItem exists      â”‚
          â”‚  â”œâ”€ Update: status/serving_status â”‚
          â”‚  â””â”€ Response: updated item        â”‚
          â”‚                                    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          (Mongoose ODM - MongoDB Driver)
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚    DATABASE (MongoDB)           â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚                                 â”‚
          â”‚  Collections:                  â”‚
          â”‚                                 â”‚
          â”‚  OrderItems                    â”‚
          â”‚  â”œâ”€ _id                        â”‚
          â”‚  â”œâ”€ item (ref: MenuItem)       â”‚
          â”‚  â”œâ”€ reservation (ref: Res.)    â”‚
          â”‚  â”œâ”€ quantity                   â”‚
          â”‚  â”œâ”€ note                       â”‚
          â”‚  â”œâ”€ status: waiting/cooking/   â”‚
          â”‚  â”‚          cooked             â”‚
          â”‚  â”œâ”€ serving_status: served/    â”‚
          â”‚  â”‚               unserved      â”‚
          â”‚  â”œâ”€ price_at_time              â”‚
          â”‚  â”œâ”€ ordered_at (ISO Date)      â”‚
          â”‚  â””â”€ created_at, updated_at    â”‚
          â”‚                                 â”‚
          â”‚  MenuItems                     â”‚
          â”‚  â”œâ”€ _id                        â”‚
          â”‚  â”œâ”€ name                       â”‚
          â”‚  â”œâ”€ price                      â”‚
          â”‚  â”œâ”€ image                      â”‚
          â”‚  â”œâ”€ category                   â”‚
          â”‚  â””â”€ description                â”‚
          â”‚                                 â”‚
          â”‚  Reservations                  â”‚
          â”‚  â”œâ”€ _id                        â”‚
          â”‚  â”œâ”€ orderItems (array refs)    â”‚
          â”‚  â””â”€ (other fields)             â”‚
          â”‚                                 â”‚
          â”‚  ReservationTables             â”‚
          â”‚  â”œâ”€ _id                        â”‚
          â”‚  â”œâ”€ reservationId (ref)        â”‚
          â”‚  â”œâ”€ tableId (ref: Table)       â”‚
          â”‚  â””â”€ status                     â”‚
          â”‚                                 â”‚
          â”‚  Tables                        â”‚
          â”‚  â”œâ”€ _id                        â”‚
          â”‚  â”œâ”€ name                       â”‚
          â”‚  â”œâ”€ capacity                   â”‚
          â”‚  â””â”€ status                     â”‚
          â”‚                                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Data Flow Diagram

#### Waiter Workflow - Complete Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Waiter Opens   â”‚
â”‚ /delivery      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component: StaffDelivery.jsx        â”‚
â”‚ - useState: loading, error, orders  â”‚
â”‚ - useEffect: fetchOrders()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: apiCall('/api/orderitems/ â”‚
â”‚           waiter/delivery')         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: GET /waiter/delivery        â”‚
â”‚ 1. Query OrderItems (4 statuses)    â”‚
â”‚ 2. Populate MenuItem details        â”‚
â”‚ 3. Enrich with table names          â”‚
â”‚ 4. Sort by ordered_at ASC           â”‚
â”‚ 5. Limit served to 20               â”‚
â”‚ 6. Return grouped response          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Queries:                   â”‚
â”‚ - OrderItem.find({status: 'cooked', â”‚
â”‚    serving_status: 'unserved'})      â”‚
â”‚ - OrderItem.find({status: 'cooked',  â”‚
â”‚    serving_status: 'served'})        â”‚
â”‚ - OrderItem.find({status: 'cooking'})â”‚
â”‚ - OrderItem.find({status: 'waiting'})â”‚
â”‚ - ReservationTable.findOne() Ã— N     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response received in Frontend:       â”‚
â”‚ {                                    â”‚
â”‚   "cooked": {                        â”‚
â”‚     "unserved": [{...}, {...}],      â”‚
â”‚     "served": [{...}, {...}]         â”‚
â”‚   },                                 â”‚
â”‚   "cooking": [{...}],                â”‚
â”‚   "waiting": [{...}]                 â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render UI:                           â”‚
â”‚ - 4 Sections with emoji headers     â”‚
â”‚ - Grid of OrderItemCard components  â”‚
â”‚ - Each card shows item details      â”‚
â”‚ - Status dropdown on each card      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks status on unserved item  â”‚
â”‚ Dropdown options appear:             â”‚
â”‚ - ChÆ°a Phá»¥c Vá»¥ (unserved)           â”‚
â”‚ - ÄÃ£ Phá»¥c Vá»¥ (served)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks "ÄÃ£ Phá»¥c Vá»¥"            â”‚
â”‚ Trigger: handleStatusChange()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: PUT /api/orderitems/{id}  â”‚
â”‚ Body: {                              â”‚
â”‚   "status": "cooked",                â”‚
â”‚   "serving_status": "served"         â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: PUT /api/orderitems/:id     â”‚
â”‚ 1. Verify token                     â”‚
â”‚ 2. Find OrderItem by ID             â”‚
â”‚ 3. Update serving_status to 'served'â”‚
â”‚ 4. Save to database                 â”‚
â”‚ 5. Return success response          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend receives success            â”‚
â”‚ Call fetchOrders() to refresh        â”‚
â”‚ Item moves to "ÄÃ£ Phá»¥c Vá»¥" section   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Every 5 seconds:                    â”‚
â”‚ - Auto-refresh triggered            â”‚
â”‚ - New items appear automatically    â”‚
â”‚ - Smooth updates without reload     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### Chef Workflow - Complete Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chef Opens     â”‚
â”‚ /kitchen       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component: KitchenOrder.jsx         â”‚
â”‚ - useState: loading, error, orders  â”‚
â”‚ - useEffect: fetchOrders()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: apiCall('/api/orderitems/ â”‚
â”‚           chef/orders')             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: GET /chef/orders            â”‚
â”‚ 1. Query OrderItems (3 statuses)    â”‚
â”‚ 2. Populate MenuItem details        â”‚
â”‚ 3. Enrich with table names          â”‚
â”‚ 4. Sort by ordered_at ASC           â”‚
â”‚ 5. Limit cooked to 20               â”‚
â”‚ 6. Return grouped response          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Queries:                   â”‚
â”‚ - OrderItem.find({status: 'waiting'})â”‚
â”‚ - OrderItem.find({status: 'cooking'})â”‚
â”‚ - OrderItem.find({status: 'cooked'}) â”‚
â”‚   limit(20)                          â”‚
â”‚ - ReservationTable.findOne() Ã— N     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response received in Frontend:       â”‚
â”‚ {                                    â”‚
â”‚   "waiting": [{...}, {...}],         â”‚
â”‚   "cooking": [{...}],                â”‚
â”‚   "cooked": [{...}, {...}]           â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render UI:                           â”‚
â”‚ - "Chá» Náº¥u" section with âš ï¸ badge  â”‚
â”‚ - Grid of OrderItemCard components  â”‚
â”‚ - Each card: item, table, qty, time  â”‚
â”‚ - Status dropdown options            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chef sees waiting items (red badge)  â”‚
â”‚ Clicks item from "Chá» Náº¥u" section  â”‚
â”‚ Status dropdown shows options:       â”‚
â”‚ - Chá» Náº¥u (waiting)                 â”‚
â”‚ - Äang Náº¥u (cooking)                â”‚
â”‚ - ÄÃ£ Náº¥u Xong (cooked)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chef clicks "Äang Náº¥u"              â”‚
â”‚ Trigger: handleStatusChange()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: PUT /api/orderitems/{id}  â”‚
â”‚ Body: { "status": "cooking" }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend updates item status to       â”‚
â”‚ 'cooking' in database                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Item moves to "Äang Náº¥u" section    â”‚
â”‚ Chef cooks the dish...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ When done, Chef clicks status again  â”‚
â”‚ Changes from "Äang Náº¥u" to "ÄÃ£ Náº¥u" â”‚
â”‚ Trigger: handleStatusChange()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Call: PUT /api/orderitems/{id}  â”‚
â”‚ Body: { "status": "cooked" }         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend updates to 'cooked' status   â”‚
â”‚ Item moves to "ÄÃ£ Náº¥u Xong"         â”‚
â”‚ Waiter can now see and pick up       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Every 5 seconds:                    â”‚
â”‚ - Auto-refresh keeps data fresh     â”‚
â”‚ - New orders appear from waiter     â”‚
â”‚ - Done items shown (recent 20)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Component Hierarchy

```
App.jsx
â”œâ”€ Routes
â”‚  â”œâ”€ /delivery
â”‚  â”‚  â””â”€ RouteGuard
â”‚  â”‚     â””â”€ ProtectedRoute (waiter)
â”‚  â”‚        â””â”€ StaffDelivery.jsx âœ…
â”‚  â”‚           â””â”€ OrderItemCard.jsx Ã— N
â”‚  â”‚              â”œâ”€ Image
â”‚  â”‚              â”œâ”€ Name
â”‚  â”‚              â”œâ”€ Table
â”‚  â”‚              â”œâ”€ Quantity
â”‚  â”‚              â”œâ”€ Status Dropdown
â”‚  â”‚              â””â”€ Notes
â”‚  â”‚
â”‚  â””â”€ /kitchen
â”‚     â””â”€ RouteGuard
â”‚        â””â”€ ProtectedRoute (chef)
â”‚           â””â”€ KitchenOrder.jsx âœ…
â”‚              â””â”€ OrderItemCard.jsx Ã— N
â”‚                 â””â”€ (same structure)
â”‚
â””â”€ RoleSidebar
   â”œâ”€ Menu Items (from rolePermissions.js)
   â”‚  â”œâ”€ Waiter: "Giao MÃ³n" â†’ /delivery
   â”‚  â””â”€ Chef: "Gá»i MÃ³n" â†’ /kitchen
   â”‚
   â””â”€ Footer
      â”œâ”€ User Profile
      â””â”€ Logout Button
```

---

### State Management Flow

#### StaffDelivery.jsx State:
```
loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ False when data loaded
   â”‚                             (show spinner if True)
   â”‚
error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Error message or null
   â”‚                             (show error box if set)
   â”‚
orders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ {
   â”‚                              cooked: {
   â”‚                                unserved: [],
   â”‚                                served: []
   â”‚                              },
   â”‚                              cooking: [],
   â”‚                              waiting: []
   â”‚                            }
   â”‚
updating â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ True during status update
                                 (disable buttons)
                        
useEffect (5s interval)
   â”‚
   â””â”€ fetchOrders() â”€â”€â”¬â”€ GET /api/orderitems/waiter/delivery
                      â””â”€ Update state
```

#### KitchenOrder.jsx State:
```
loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Same as waiter
   â”‚
error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Same as waiter
   â”‚
orders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ {
   â”‚                              waiting: [],
   â”‚                              cooking: [],
   â”‚                              cooked: []
   â”‚                            }
   â”‚
updating â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Same as waiter
                        
useEffect (5s interval)
   â”‚
   â””â”€ fetchOrders() â”€â”€â”¬â”€ GET /api/orderitems/chef/orders
                      â””â”€ Update state
```

---

### Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Requests /delivery                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Route Guard        â”‚
    â”‚ - Check user loggedâ”‚
    â”‚ - Check role match â”‚
    â”‚ - Redirect if no   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ProtectedRoute     â”‚
    â”‚ - Verify required  â”‚
    â”‚   roles (waiter)   â”‚
    â”‚ - Show access deny â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Component Loads    â”‚
    â”‚ - useState setup   â”‚
    â”‚ - useEffect       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API Call           â”‚
    â”‚ - Include token    â”‚
    â”‚ - Send request     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend Middleware â”‚
    â”‚ - verifyToken      â”‚
    â”‚ - Extract user     â”‚
    â”‚ - Verify DB access â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database Query     â”‚
    â”‚ - Limited to user  â”‚
    â”‚ - Return only own  â”‚
    â”‚   restaurant data  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Performance Optimization Points

```
Frontend:
â”œâ”€ useMemo for grouping logic (if large dataset)
â”œâ”€ 5 second auto-refresh (not 1s)
â”œâ”€ Capped grid items (1-4 columns max)
â”œâ”€ Lazy load images
â””â”€ Event delegation for cards

Backend:
â”œâ”€ .lean() on all queries (no hydration)
â”œâ”€ Select specific fields only
â”œâ”€ Index on ordered_at for sorting
â”œâ”€ Index on status for filtering
â”œâ”€ Limit queries (max 20 served/done)
â”œâ”€ Connection pooling
â””â”€ Caching for menu items (if same restaurant)

Database:
â”œâ”€ Compound index: (status, ordered_at)
â”œâ”€ Index on reservation._id
â”œâ”€ Index on item._id
â””â”€ Regular vacuum/maintenance
```

---

### Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StaffDelivery & KitchenOrder        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WaiterOrder  â”‚  â”‚ TableManage  â”‚
â”‚ Modal (add)  â”‚  â”‚ ment         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ OrderItems   â”‚
        â”‚ Database     â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ MenuItems     â”‚
        â”‚ Reservations  â”‚
        â”‚ Tables        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Architecture Version**: 1.0  
**Last Updated**: 2025-01-15  
**Status**: âœ… Complete
